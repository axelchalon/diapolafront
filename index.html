<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://unpkg.com/vue"></script>
    <script src="js/prefixfree.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="app">
        
        <div class="signUp" v-if="signUpShown">
            <div class="signUp_modal">
                <h3>S'inscrire</h3>
                
                <form>
                    
                    <div class="signUp_modal_left">
                        <label for="signUp_lastname">Nom</label><br>
                        <input type="email" id="signUp_lastname"><br>
                    </div>
                    <div class="signUp_modal_right">
                        <label for="signUp_firstname">Prénom</label><br>
                        <input type="email" id="signUp_firstname"><br>
                    </div>
                    <div style="clear:both;"></div>
                    
                    <label for="signUp_email">Adresse mail</label><br>
                    <input type="email" id="signUp_email"><br>
                    
                    <div class="signUp_modal_left">
                        <label for="signUp_password">Mot de passe</label><br>
                        <input type="password" id="signUp_password"><br>
                    </div>
                    <div class="signUp_modal_right">
                        <label for="signUp_password_confirm">Mot de passe</label><br>
                        <input type="password" id="signUp_password_confirm"><br>
                    </div>
                    <div style="clear:both;"></div>
                    
                    
                    <button type="submit" @click.prevent="signUp($event.target.parentNode.querySelector('#signUp_lastname').value, $event.target.parentNode.querySelector('#signUp_firstname').value, $event.target.parentNode.querySelector('#signUp_email').value, $event.target.parentNode.querySelector('#signUp_password').value, $event.target.parentNode.querySelector('#signUp_password_confirm').value)">S'inscrire</button>
                    
                    <small>Déjà un compte ? <a href="#" @click.prevent="signUpShown = false">Se connecter</a></small>
                </form>
            </div>
        </div>
        
        <div class="login" v-if="!account.loggedIn && !signUpShown">
            <div class="login_modal">
                <h3>S'identifier</h3>
                
                <form>
                    <label for="login_email">Adresse mail</label><br>
                    <input type="email" id="login_email"><br>
                    
                    
                    <label for="login_password">Mot de passe</label><br>
                    <input type="password" id="login_password"><br>
                    
                    
                    <button type="submit" @click.prevent="logIn($event.target.parentNode.querySelector('#login_email').value, $event.target.parentNode.querySelector('#login_password').value)">Se connecter</button>
                    
                    <small>Pas encore de compte ? <a href="#" @click.prevent="signUpShown = true">S'inscrire</a></small>
                </form>
            </div>
        </div>
        
        <div class="app" v-if="account.loggedIn">
            <div class="topBar">
                <h1 class="logo"></h1>

                <input class="search" type="search" placeholder="Rechercher dans vos présentations" @keyup.enter="search($event.target.value); $event.target.value=''; ">

                <a class="manageCollaborators" href="#"></a>
                <div class="myProfile">
                    <a href="#" :style='{"background-image": "url(" + account.avatarPreviewUrl + ")"}' onclick="this.parentNode.querySelector('.component_burger_toggle').click()"></a>
                    <burger align="right" :items="[{text: 'Mon compte'}, {text: 'Déconnexion'}]"></burger>
                </div>

                <div style="clear: both;"></div>
                <!-- ---- -->
                <div class="topBar_innerSeparator"></div>

                <button class="importPresentation" href="#">Importer une présentation</button>

                <div class="breadcrumbs" v-if="page == 'presentation'">
                    <a class="breadcrumbs_breadcrumb" href="#">Mon dossier</a>
                    <span class="breadcrumbs_separator">&gt;</span>
                    <a class="breadcrumbs_breadcrumb breadcrumbs_breadcrumb-active" href="#" >Nom de la présentation</a>
                    <burger align="left" :items="[{text: 'Mots-clés', callback: presentationShowKeywords}, {text: 'Renommer', callback: presentationRename}, {text: 'Supprimer', callback: presentationShowConfirmDelete}]"></burger>
                </div>
            </div>

            <div class="page">

                <div class="page_left">
                    Arborescence de fichiers ici...
                </div>

                <div class="page_right">
                    <div class="page_right_topBar page_right_topBar-presentation" v-if="page == 'presentation'">
                        <button class="downloadPresentation">Télécharger la présentation</button>
                        <button class="downloadSelectedSlides downloadSelectedSlides-disabled">Télécharger la sélection</button>

                        <div class="presentationComment">
                            <h3>Commentaire</h3> <a href="#" class="presentationComment-edit">Modifier</a><br>
                            <p>{{presentationComment}}</p>
                        </div>
                    </div>

                    <div v-if="page == 'search'" class="page_right_topBar page_right_topBar-search">
                        <h2>{{searchResults.length}} résultats trouvés pour &ldquo;{{searchQuery}}&rdquo;</h2>

                        <ul>
                            <li :class="{active: searchTab == 'all'}"><a href="#" @click.prevent="searchTab = 'all'">Tout ({{searchResults.length}})</a></li>
                            <li :class="{active: searchTab == 'slides'}"><a href="#" @click.prevent="searchTab = 'slides'">Slides ({{searchResultsSlides.length}})</a></li>
                            <li :class="{active: searchTab == 'presentations'}" @click.prevent="searchTab = 'presentations'"><a href="#">Présentations ({{searchResultsPresentations.length}})</a></li>
                        </ul>
                    </div>

                    <div v-if="page == 'search'" class="page_right_page">
                        <a v-for="searchResult in (searchTab == 'all' ? searchResults : searchTab == 'slides' ? searchResultsSlides : searchResultsPresentations)" class="page_right_page_slide" :style='{"background-image": "url(" + searchResult.previewUrl + ")"}' href="#" @click.prevent="searchResult.type == 'slide' ? launchDiaporamaOnSlide(searchResult) : viewPresentationForSlide(searchResult)">

                            <p v-if="searchResult.type == 'slide'" class="page_right_page_slide_presentationTitle">{{searchResult.presentationTitle}}</p>
                        </a>
                    </div>

                    <div v-if="page == 'presentation'" class="page_right_page">
                        <a v-for="presentationSlide in presentationSlides" class="page_right_page_slide" href="#" @click.prevent="launchDiaporamaOnSlide(presentationSlide)">
                        </a>
                    </div>


                </div>
            </div>

            <div class="bottomBar" :class='{"bottomBar-active": bottomBarActive}'>
                <a class="bottomBar_toggler" href="#" @click.prevent="bottomBarActive = !bottomBarActive">^</a>
                <button class="downloadGeneratedPresentation" href="#">Télécharger</button>
                <button class="saveGeneratedPresentation" href="#">Sauvegarder</button>
                <a class="clearGeneratedPresentation" href="#" @click.prevent="generatedPresentationSlides = []"><span class="clearGeneratedPresentation_icon"></span>Tout effacer</a>

                <div style="clear:both;"></div>

                <div class="bottomBar_delineator"></div>

                <ul class="bottomBar_listOfSlides">
                    <li v-for="(generatedPresentationSlide, index) in generatedPresentationSlides" class="bottomBar_listOfSlides_slide">
                        <div class="bottomBar_listOfSlides_slide_image" :style='{"background-image": "url(" + generatedPresentationSlide.previewUrl + ")"}'></div>
                        <p class="bottomBar_listOfSlides_slide_title">{{generatedPresentationSlide.title}}</p>
                        <a class="bottomBar_listOfSlides_slide_remove" href="#" v-on:click.prevent="removeGeneratedPresentationSlide(index)">
                            &times;
                        </a>
                    </li>

                    <li class="bottomBar_listOfSlides_placeholder"></li>
                    <li class="bottomBar_listOfSlides_placeholder"></li>
                    <li class="bottomBar_listOfSlides_placeholder"></li>
                    <li class="bottomBar_listOfSlides_placeholder"></li>
                    <li class="bottomBar_listOfSlides_placeholder"></li>
                    <li class="bottomBar_listOfSlides_placeholder"></li>
                    <li class="bottomBar_listOfSlides_placeholder"></li>
                </ul>
            </div>

            <div v-show="presentationKeywordsShown" class="presentationKeywords">
                <div class="presentationKeywords_modal">
                    <a href="#" class="presentationKeywords_modal_close" @click.prevent="presentationKeywordsShown = false">&times;</a>
                    <h3>Mots-clés de la présentation</h3>
                    <tags :tags="presentationTags" :on-tag-add="addTagToPresentation" :on-tag-remove="removeTagFromPresentation"></tags>
                </div>
            </div>

            <div v-show="presentationConfirmDeleteShown" class="presentationShowConfirmDelete">
                <div class="presentationShowConfirmDelete_modal">
                    <a href="#" class="presentationShowConfirmDelete_modal_close" @click.prevent="presentationConfirmDeleteShown = false">&times;</a>
                    <h3>Êtes-vous sûr de vouloir supprimer la présentation ?</h3>
                    <button class="presentationShowConfirmDelete_modal_yes" @click.href="deletePresentation">Oui</button>
                    <button class="presentationShowConfirmDelete_modal_no" @click.href="presentationConfirmDeleteShown = false">Non</button>
                </div>
            </div>

            <div v-show="diaporamaMode" class="diaporama">

                <a href="#" @click.prevent="diaporamaMode = false" class="diaporama_exit">Fermer le mode lecture</a>

                <div class="diaporama_previousSlide" v-if="diaporamaCurrentSlideIndex > 0" :style='{"background-image": "url(" + diaporamaSlides[diaporamaCurrentSlideIndex-1].viewUrl + ")"}' @click.prevent="diaporamaCurrentSlideIndex--"></div>
                <div class="diaporama_nextSlide" v-if="diaporamaCurrentSlideIndex < diaporamaSlides.length-1" :style='{"background-image": "url(" + diaporamaSlides[diaporamaCurrentSlideIndex+1].viewUrl + ")"}' @click.prevent="diaporamaCurrentSlideIndex++"></div>

                <div class="diaporama_currentSlide" :style='{"background-image": "url(" + diaporamaSlides[diaporamaCurrentSlideIndex].viewUrl + ")"}'></div>
                <div class="diaporama_currentSlideInformation">
                    <div class="diaporama_currentSlideInformation_tags">
                        <h3>Mots-clés</h3>
                        <tags :tags="diaporamaSlides[diaporamaCurrentSlideIndex].tags" :on-tag-add="addTagToSlide" :on-tag-remove="removeTagFromSlide"></tags>
                    </div>
                    <div class="diaporama_currentSlideInformation_comment">
                        <h3>Commentaire de diapositive</h3>
                        <p>{{diaporamaSlides[diaporamaCurrentSlideIndex].comment}}</p>
                    </div>
                </div>

                <div class="diaporama_banner">
                    <div class="diaporama_banner_text">
                        {{diaporamaPresentationTitle}}
                        <small>{{diaporamaCurrentSlideIndex+1}}/{{diaporamaSlides.length}}</small>
                    </div>

                    <a class="diaporama_gotoPreviousSlide" href="#" v-if="diaporamaCurrentSlideIndex > 0" @click.prevent="diaporamaCurrentSlideIndex--"></a>
                    <a class="diaporama_gotoNextSlide" href="#" v-if="diaporamaCurrentSlideIndex < diaporamaSlides.length-1" @click.prevent="diaporamaCurrentSlideIndex++"></a>
                </div>

            </div>
        </div>
    </div>

    <script>
        
        // register
        Vue.component('burger', {
          props: {
              items: Array,
              align: String
          },
          data: function() {
              return {active: false};
          },
          template: `
                <div class="component_burger" v-bind:class='{"component_burger-active": active, "component_burger-alignLeft": align == "left", "component_burger-alignRight": align == "right" }'>
                    <a href="#" v-on:click.prevent="active = !active" class="component_burger_toggle">&sdot; &sdot; &sdot;</a>
                    <ul>
                        <li v-for="item in items"><a href="#" @click.prevent="item.callback(); active = false;">{{item.text}}</a></li>
                    </ul>
                </div>`
        })
        
        Vue.component('tags', {
          props: {
              tags: Array,
              onTagAdd: Function,
              onTagRemove: Function,
          },
          template:
            `<div class="component_tags">
                <ul>
                    <li class="component_tags_tag" v-for="tag in tags">
                        <a class="component_tags_tag_close" href="#" @click.prevent="onTagRemove(tag)">
                            &times;
                        </a>
                        {{tag}}
                    </li>
                </ul>

                <div class="component_tags_addTag">
                    <input placeholder="Ajouter un tag">
                    <button @click.prevent="onTagAdd($event.target.parentNode.querySelector('input').value); $event.target.parentNode.querySelector('input').value='';">+</button>
                </div>
            </div>`
        })
        
        var app = new Vue({
            el: '#app',
            data: {
                account: {
                  loggedIn: false,
                  avatarPreviewUrl: "https://placecage.com/50/50"
                },
                signUpShown: true,
                message: 'Hello Vue!',
                bottomBarActive: true,
                page: "presentation",
                diaporamaMode: false,
                diaporamaPresentationTitle: "Nom de la préz!",
                diaporamaCurrentSlideIndex: 0,
                diaporamaSlides: [{viewUrl: "https://www.placecage.com/1200/900", tags: ["onea","oneb","onec"], comment: "Lorem ipsum..."}, {viewUrl: "https://www.placecage.com/1200/900", tags: ["twox","twoc","twod"], comment: "Lorem ipsum 2..."}, {viewUrl: "https://www.placecage.com/1200/900", tags: ["threea","threeb","threec"], comment: "Lorem ipsum 3..."} ],
                presentationTags: ["tag prez", "tag prez2"],
                presentationSlides: [{},{},{},{},{},{},{}],
                presentationComment: "Duis ultrices vestibulum lacus non luctus. Praesent aliquet, justo ut accumsan bibendum, sem erat sagittis nunc, a vulputate diam ulla nisi.",
                presentationKeywordsShown: false,
                presentationConfirmDeleteShown: false,
                generatedPresentationSlides: [{title: "Nom de la présentation",previewUrl: "https://www.placecage.com/200/130"}],
                searchTab: "all",
                searchQuery: "",
                searchResults: []
            },
            computed: {
                searchResultsSlides: function() {
                    return this.searchResults.filter(x => x.type == "slide");
                },
                searchResultsPresentations: function() {
                    return this.searchResults.filter(x => x.type == "presentation");
                }  
            },
            methods: {
                removeGeneratedPresentationSlide: function(index) {
                    this.$delete(this.generatedPresentationSlides, index);
                },
                launchDiaporamaOnSlide: function(slide) {
                    this.diaporamaMode = true;
                    // hydrate diaporamaPresentationTitle
                    // hydrate diaporamaCurrentSlideIndex
                    // diaporamaSlides
                },
                addTagToPresentation: function(tag) {
                  // faire requête serveur pour update tags
                    this.presentationTags.push(tag);
                },
                removeTagFromPresentation: function (tag) {
                  // faire requête serveur pour update tags
                    this.presentationTags = this.presentationTags.filter(x => x != tag);
                },
                addTagToSlide: function(tag,slide) {
                  // faire requête serveur pour update tags
                    this.diaporamaSlides[0].tags.push(tag);
                },
                removeTagFromSlide: function (tag,slide) {
                  // faire requête serveur pour update tags
                    this.diaporamaSlides[0].tags = this.diaporamaSlides[0].tags.filter(x => x != tag);
                },
                viewPresentationForSlide: function(slide) {
                    // faire requête serveur pour récup liste des slides de la présentation et infos présentation
                    this.page = 'presentation';  
                    // presentationTags...
                },
                presentationShowKeywords: function() {
                  this.presentationKeywordsShown = true;
                },
                presentationRename: function() {
                    prompt(':hap:')
                },
                presentationShowConfirmDelete: function() {
                  this.presentationConfirmDeleteShown = true;
                },
                deletePresentation: function() {
                    alert('del');
                  // requête serveur delete presentation
                  // changer this.presentation et revenir à la home
                    this.presentationConfirmDeleteShown = false;
                },
                logIn: function(email,password) {
                    console.log(email,password)
                    API.logIn(email,password).then((res) => {
                        console.log('(VUE) API RESPONSE :',res)
                        this.account.loggedIn = true;
                    }).catch(this.logOut)
                },
                signUp: function(lastname,firstname,email,password,password_confirm) {
                    console.log(lastname,firstname,email,password,password_confirm)
                    
                    API.signUp(lastname,firstname,email,password,password_confirm).then((res) => {
                        console.log('(VUE) API RESPONSE :',res)
                        this.account.loggedIn = true;
                        this.signUpShown = false;
                    }).catch(this.logOut)
                },
                logOut: function () {
                    console.log('log out')  
                    this.account.loggedIn = false;
                },
                search: function (q) {
                    this.page = "search";
                    this.searchTab = "all";
                    this.searchQuery = q;
                    this.searchResults = [
                        {
                            presentationTitle: "Slide prez",
                            type: "slide",
                            previewUrl: "https://www.placecage.com/200/130"
                        },
                        {
                            presentationTitle: "Slide prez",
                            type: "slide",
                            previewUrl: "https://www.placecage.com/200/130"
                        },
                        {
                            presentationTitle: "Slide prez",
                            type: "slide",
                            previewUrl: "https://www.placecage.com/200/130"
                        },
                        {
                            title: "Presentation",
                            type: "presentation",
                            previewUrl: "https://www.placecage.com/200/130"
                        }
                    ];
                }
            }
        })
    </script>
    <script src="js/api.js"></script>
            

</body>

</html>